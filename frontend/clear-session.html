<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—á–∏—â–µ–Ω–Ω—è —Å–µ—Å—ñ—ó - Pizza System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #e74c3c;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .button:hover {
            background: #c0392b;
        }
        .info {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .success {
            background: #d5f4e6;
            color: #27ae60;
        }
        .error {
            background: #ffeaa7;
            color: #e17055;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏</h1>
        <p>–¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–æ–ø–æ–º–æ–∂–µ –≤–∏—Ä—ñ—à–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –≤—Ö–æ–¥–æ–º.</p>
        
        <div class="info">
            <h3>–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:</h3>
            <p id="session-status">–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...</p>
        </div>
        
        <button class="button" onclick="checkSession()">üîç –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–µ—Å—ñ—é</button>
        <button class="button" onclick="clearSession()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ —Å–µ—Å—ñ—é</button>
        <button class="button" onclick="logout()">üîì –í–∏–π—Ç–∏</button>
        
        <div id="result" class="info" style="display: none;"></div>
        
        <hr>
        <p><a href="/login.html">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≤—Ö–æ–¥—É</a></p>
        <p><a href="/">‚Üê –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a></p>
    </div>

    <script>
        const API_URL = '/api';
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å–µ—Å—ñ—é –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        document.addEventListener('DOMContentLoaded', function() {
            checkSession();
        });
        
        async function checkSession() {
            showResult('–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å–µ—Å—ñ—é...', 'info');
            
            try {
                const response = await fetch(`${API_URL}/auth/me`, {
                    method: 'GET',
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.data) {
                        document.getElementById('session-status').innerHTML = 
                            `‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ —Å–µ—Å—ñ—è: ${data.data.user.username} (${data.data.user.role})`;
                        showResult(`–ó–Ω–∞–π–¥–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞ —Å–µ—Å—ñ—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: ${data.data.user.username}`, 'info');
                    } else {
                        document.getElementById('session-status').innerHTML = '‚ùå –°–µ—Å—ñ—è –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞';
                        showResult('–ê–∫—Ç–∏–≤–Ω–∏—Ö —Å–µ—Å—ñ–π –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ', 'success');
                    }
                } else {
                    document.getElementById('session-status').innerHTML = '‚ùå –°–µ—Å—ñ—è –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞';
                    showResult('–ê–∫—Ç–∏–≤–Ω–∏—Ö —Å–µ—Å—ñ–π –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ', 'success');
                }
            } catch (error) {
                document.getElementById('session-status').innerHTML = '‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏';
                showResult(`–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å–µ—Å—ñ—ó: ${error.message}`, 'error');
            }
        }
        
        async function clearSession() {
            showResult('–û—á–∏—â–∞—î–º–æ —Å–µ—Å—ñ—é...', 'info');
            
            try {
                // –°–ø—Ä–æ–±—É—î–º–æ –≤–∏–π—Ç–∏ —á–µ—Ä–µ–∑ API
                const response = await fetch(`${API_URL}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    showResult('‚úÖ –°–µ—Å—ñ—è –æ—á–∏—â–µ–Ω–∞ —á–µ—Ä–µ–∑ API', 'success');
                } else {
                    showResult('‚ö†Ô∏è API logout –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤, –æ—á–∏—â–∞—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ', 'info');
                }
            } catch (error) {
                showResult('‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ API, –æ—á–∏—â–∞—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ', 'info');
            }
            
            // –û—á–∏—â–∞—î–º–æ –≤—Å—ñ localStorage —Ç–∞ sessionStorage
            localStorage.clear();
            sessionStorage.clear();
            
            // –û—á–∏—â–∞—î–º–æ cookies –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é JavaScript
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            showResult('üßπ –õ–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç...', 'success');
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(checkSession, 1000);
        }
        
        async function logout() {
            showResult('–í–∏—Ö–æ–¥–∏–º–æ –∑ —Å–∏—Å—Ç–µ–º–∏...', 'info');
            
            try {
                const response = await fetch(`${API_URL}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showResult('‚úÖ –£—Å–ø—ñ—à–Ω–æ –≤–∏–π—à–ª–∏ –∑ —Å–∏—Å—Ç–µ–º–∏', 'success');
                    setTimeout(() => {
                        window.location.href = '/login.html';
                    }, 1500);
                } else {
                    showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏—Ö–æ–¥—É: ${data.error?.message || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è: ${error.message}`, 'error');
            }
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            resultDiv.className = `info ${type}`;
            resultDiv.style.display = 'block';
        }
    </script>
</body>
</html> 