<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–≥–∏ –æ–ø–µ—Ä–∞—Ü—ñ–π - Pizza Inventory System</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/navigation.css">
    <link rel="stylesheet" href="/styles/tables.css">
    <link rel="stylesheet" href="/styles/forms.css">
    <link rel="stylesheet" href="/styles/buttons.css">
    <link rel="stylesheet" href="/styles/modals-tabs.css">
    <link rel="stylesheet" href="/styles/operations.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
</head>
<body>
    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ navigation.js -->

    <!-- –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container">
        <div class="page-header">
            <h1>üìã –ñ—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü—ñ–π</h1>
            <p>–Ü—Å—Ç–æ—Ä—ñ—è –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –≤ —Å–∏—Å—Ç–µ–º—ñ</p>
        </div>

        <!-- –§—ñ–ª—å—Ç—Ä–∏ -->
        <div class="filters-section">
            <div class="filter-group">
                <label for="operationTypeFilter">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó:</label>
                <select id="operationTypeFilter">
                    <option value="">–í—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó</option>
                    <option value="CREATE_ORDER">–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</option>
                    <option value="UPDATE_ORDER">–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</option>
                    <option value="UPDATE_ORDER_STATUS">–ó–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É</option>
                    <option value="PRODUCTION">–í–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ</option>
                    <option value="WRITEOFF">–°–ø–∏—Å–∞–Ω–Ω—è</option>
                    <option value="ARRIVAL">–ü—Ä–∏—Ö–æ–¥</option>
                    <option value="CREATE_PRODUCT">–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É</option>
                    <option value="UPDATE_PRODUCT">–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="entityTypeFilter">–¢–∏–ø —Å—É—Ç–Ω–æ—Å—Ç—ñ:</label>
                <select id="entityTypeFilter">
                    <option value="">–í—Å—ñ —Ç–∏–ø–∏</option>
                    <option value="order">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</option>
                    <option value="product">–¢–æ–≤–∞—Ä–∏</option>
                    <option value="production">–í–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ</option>
                    <option value="client">–ö–ª—ñ—î–Ω—Ç–∏</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="userNameFilter">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:</label>
                <input type="text" id="userNameFilter" placeholder="–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞">
            </div>

            <div class="filter-group">
                <label for="dateFromFilter">–î–∞—Ç–∞ –≤—ñ–¥:</label>
                <input type="date" id="dateFromFilter">
            </div>

            <div class="filter-group">
                <label for="dateToFilter">–î–∞—Ç–∞ –¥–æ:</label>
                <input type="date" id="dateToFilter">
            </div>

            <div class="filter-actions">
                <button id="applyFiltersBtn" class="btn btn-primary">üîç –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
                <button id="clearFiltersBtn" class="btn btn-secondary">üîÑ –û—á–∏—Å—Ç–∏—Ç–∏</button>
                <button id="showStatsBtn" class="btn btn-info">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div id="statsSection" class="stats-section" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ–π</h3>
                    <div class="stat-value" id="totalOperations">-</div>
                </div>
                <div class="stat-card">
                    <h3>–û–ø–µ—Ä–∞—Ü—ñ–π —Å—å–æ–≥–æ–¥–Ω—ñ</h3>
                    <div class="stat-value" id="todayOperations">-</div>
                </div>
                <div class="stat-card">
                    <h3>–ê–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h3>
                    <div class="stat-value" id="activeUsers">-</div>
                </div>
                <div class="stat-card">
                    <h3>–ü–æ–ø—É–ª—è—Ä–Ω–∏–π —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó</h3>
                    <div class="stat-value" id="popularOperation">-</div>
                </div>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü—è –ª–æ–≥—ñ–≤ -->
        <div class="table-container">
            <div class="table-header">
                <h2>–ñ—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü—ñ–π</h2>
                <div class="table-actions">
                    <span id="recordsCount" class="records-count">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
                </div>
            </div>

            <div class="table-wrapper">
                <table id="operationsTable" class="data-table">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞/–ß–∞—Å</th>
                            <th>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó</th>
                            <th>–û–ø–∏—Å</th>
                            <th>–°—É—Ç–Ω—ñ—Å—Ç—å</th>
                            <th>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</th>
                            <th>–î—ñ—ó</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="6" class="loading">
                                <div class="loading-spinner"></div>
                                <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π...</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –æ–ø–µ—Ä–∞—Ü—ñ—ó -->
    <div id="operationDetailsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>–î–µ—Ç–∞–ª—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó</h2>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="operation-details">
                    <div class="detail-section">
                        <h3>–û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <strong>ID –æ–ø–µ—Ä–∞—Ü—ñ—ó:</strong>
                                <span id="detailId">-</span>
                            </div>
                            <div class="detail-item">
                                <strong>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó:</strong>
                                <span id="detailOperationType" class="operation-badge">-</span>
                            </div>
                            <div class="detail-item">
                                <strong>–î–∞—Ç–∞ —Ç–∞ —á–∞—Å:</strong>
                                <span id="detailDateTime">-</span>
                            </div>
                            <div class="detail-item">
                                <strong>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:</strong>
                                <span id="detailUser">-</span>
                            </div>
                            <div class="detail-item">
                                <strong>IP –∞–¥—Ä–µ—Å–∞:</strong>
                                <span id="detailIp">-</span>
                            </div>
                            <div class="detail-item full-width">
                                <strong>–û–ø–∏—Å:</strong>
                                <p id="detailDescription">-</p>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section" id="oldDataSection" style="display: none;">
                        <h3>–°—Ç–∞—Ä—ñ –¥–∞–Ω—ñ</h3>
                        <pre id="detailOldData" class="json-data"></pre>
                    </div>

                    <div class="detail-section" id="newDataSection" style="display: none;">
                        <h3>–ù–æ–≤—ñ –¥–∞–Ω—ñ</h3>
                        <pre id="detailNewData" class="json-data"></pre>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('operationDetailsModal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="statsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üìä –î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü—ñ–π</h2>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="statsContent">
                    <div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('statsModal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/error-handler.js"></script>
    <script src="js/navigation.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
        let currentOperations = [];
        let currentFilters = {};

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadOperations();
            
            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –¥–∞—Ç—É "–¥–æ" –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
            document.getElementById('dateToFilter').value = new Date().toISOString().split('T')[0];
        });

        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ –ø–æ–¥—ñ–π
        function setupEventListeners() {
            document.getElementById('applyFiltersBtn').addEventListener('click', applyFilters);
            document.getElementById('clearFiltersBtn').addEventListener('click', clearFilters);
            document.getElementById('showStatsBtn').addEventListener('click', showStatistics);
            
            // –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞
            document.querySelectorAll('.modal-close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    closeModal(modal.id);
                });
            });
            
            // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π
        async function loadOperations(filters = {}) {
            try {
                showLoading(true);
                
                const params = new URLSearchParams(filters);
                const response = await fetch(`/api/operations/logs?${params}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const operations = await response.json();
                currentOperations = operations;
                displayOperations(operations);
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π: ' + error.message);
                displayOperations([]);
            } finally {
                showLoading(false);
            }
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π –≤ —Ç–∞–±–ª–∏—Ü—ñ
        function displayOperations(operations) {
            const tbody = document.querySelector('#operationsTable tbody');
            
            if (!operations || operations.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="no-data">
                            üìù –ù–µ–º–∞—î –æ–ø–µ—Ä–∞—Ü—ñ–π –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
                        </td>
                    </tr>
                `;
                document.getElementById('recordsCount').textContent = '–ó–∞–ø–∏—Å—ñ–≤: 0';
                return;
            }
            
            tbody.innerHTML = operations.map(operation => `
                <tr onclick="showOperationDetails(${operation.id})">
                    <td>
                        <div class="datetime-cell">
                            <div class="date">${formatDate(operation.created_at)}</div>
                            <div class="time">${formatTime(operation.created_at)}</div>
                        </div>
                    </td>
                    <td>
                        <span class="operation-badge ${getOperationTypeClass(operation.operation_type)}">
                            ${getOperationTypeText(operation.operation_type)}
                        </span>
                    </td>
                    <td class="description-cell">
                        ${operation.description}
                        ${operation.entity_display_name ? `<br><small>–û–±'—î–∫—Ç: ${operation.entity_display_name}</small>` : ''}
                    </td>
                    <td>
                        <span class="entity-badge">${getEntityTypeText(operation.entity_type)}</span>
                        ${operation.entity_id ? `<br><small>ID: ${operation.entity_id}</small>` : ''}
                    </td>
                    <td>
                        <div class="user-cell">
                            <strong>${operation.user_name}</strong>
                            ${operation.ip_address ? `<br><small>IP: ${operation.ip_address}</small>` : ''}
                        </div>
                    </td>
                    <td>
                        <button class="btn btn-small btn-info" onclick="event.stopPropagation(); showOperationDetails(${operation.id})">
                            üëÅÔ∏è –î–µ—Ç–∞–ª—ñ
                        </button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('recordsCount').textContent = `–ó–∞–ø–∏—Å—ñ–≤: ${operations.length}`;
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
        async function showOperationDetails(operationId) {
            try {
                const operation = currentOperations.find(op => op.id === operationId);
                if (!operation) {
                    throw new Error('–û–ø–µ—Ä–∞—Ü—ñ—é –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                }
                
                // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –æ—Å–Ω–æ–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é
                document.getElementById('detailId').textContent = operation.id;
                document.getElementById('detailOperationType').textContent = getOperationTypeText(operation.operation_type);
                document.getElementById('detailOperationType').className = `operation-badge ${getOperationTypeClass(operation.operation_type)}`;
                document.getElementById('detailDateTime').textContent = formatDateTime(operation.created_at);
                document.getElementById('detailUser').textContent = operation.user_name;
                document.getElementById('detailIp').textContent = operation.ip_address || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ';
                document.getElementById('detailDescription').textContent = operation.description;
                
                // –ü–æ–∫–∞–∑—É—î–º–æ/–ø—Ä–∏—Ö–æ–≤—É—î–º–æ —Å–µ–∫—Ü—ñ—ó –∑ –¥–∞–Ω–∏–º–∏
                const oldDataSection = document.getElementById('oldDataSection');
                const newDataSection = document.getElementById('newDataSection');
                
                if (operation.old_data) {
                    document.getElementById('detailOldData').textContent = JSON.stringify(operation.old_data, null, 2);
                    oldDataSection.style.display = 'block';
                } else {
                    oldDataSection.style.display = 'none';
                }
                
                if (operation.new_data) {
                    document.getElementById('detailNewData').textContent = JSON.stringify(operation.new_data, null, 2);
                    newDataSection.style.display = 'block';
                } else {
                    newDataSection.style.display = 'none';
                }
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
                openModal('operationDetailsModal');
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø–æ–∫–∞–∑—É –¥–µ—Ç–∞–ª–µ–π –æ–ø–µ—Ä–∞—Ü—ñ—ó:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π –æ–ø–µ—Ä–∞—Ü—ñ—ó');
            }
        }

        // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
        function applyFilters() {
            const filters = {
                operation_type: document.getElementById('operationTypeFilter').value,
                entity_type: document.getElementById('entityTypeFilter').value,
                user_name: document.getElementById('userNameFilter').value,
                date_from: document.getElementById('dateFromFilter').value,
                date_to: document.getElementById('dateToFilter').value
            };
            
            // –í–∏–¥–∞–ª—è—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏
            Object.keys(filters).forEach(key => {
                if (!filters[key]) delete filters[key];
            });
            
            currentFilters = filters;
            loadOperations(filters);
        }

        // –û—á–∏—â–µ–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
        function clearFilters() {
            document.getElementById('operationTypeFilter').value = '';
            document.getElementById('entityTypeFilter').value = '';
            document.getElementById('userNameFilter').value = '';
            document.getElementById('dateFromFilter').value = '';
            document.getElementById('dateToFilter').value = new Date().toISOString().split('T')[0];
            
            currentFilters = {};
            loadOperations();
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        async function showStatistics() {
            try {
                openModal('statsModal');
                document.getElementById('statsContent').innerHTML = '<div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>';
                
                const response = await fetch('/api/operations/logs/stats?period=30');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const stats = await response.json();
                displayDetailedStats(stats);
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                document.getElementById('statsContent').innerHTML = `
                    <div class="error">
                        –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}
                    </div>
                `;
            }
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–µ—Ç–∞–ª—å–Ω–æ—ó —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function displayDetailedStats(stats) {
            const content = `
                <div class="stats-overview">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å</h3>
                            <div class="stat-value">${stats.total_operations || 0}</div>
                            <small>–∑–∞ ${stats.period_days} –¥–Ω—ñ–≤</small>
                        </div>
                        <div class="stat-card">
                            <h3>–£–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h3>
                            <div class="stat-value">${stats.summary?.reduce((sum, s) => sum + s.unique_users, 0) || 0}</div>
                        </div>
                        <div class="stat-card">
                            <h3>–¢–∏–ø—ñ–≤ –æ–ø–µ—Ä–∞—Ü—ñ–π</h3>
                            <div class="stat-value">${stats.summary?.length || 0}</div>
                        </div>
                        <div class="stat-card">
                            <h3>–°–µ—Ä–µ–¥–Ω—å–æ –∑–∞ –¥–µ–Ω—å</h3>
                            <div class="stat-value">${Math.round((stats.total_operations || 0) / (stats.period_days || 1))}</div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-details">
                    <h3>–û–ø–µ—Ä–∞—Ü—ñ—ó –ø–æ —Ç–∏–ø–∞—Ö</h3>
                    <div class="stats-table">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó</th>
                                    <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                                    <th>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</th>
                                    <th>–û—Å—Ç–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${stats.summary?.map(item => `
                                    <tr>
                                        <td>
                                            <span class="operation-badge ${getOperationTypeClass(item.operation_type)}">
                                                ${getOperationTypeText(item.operation_type)}
                                            </span>
                                        </td>
                                        <td><strong>${item.total_count}</strong></td>
                                        <td>${item.unique_users}</td>
                                        <td>${formatDateTime(item.last_operation)}</td>
                                    </tr>
                                `).join('') || '<tr><td colspan="4">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('statsContent').innerHTML = content;
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('uk-UA');
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' });
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('uk-UA');
        }

        function getOperationTypeText(type) {
            const typeMap = {
                'CREATE_ORDER': '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è',
                'UPDATE_ORDER': '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è',
                'UPDATE_ORDER_STATUS': '–ó–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É',
                'DELETE_ORDER': '–í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è',
                'CREATE_PRODUCT': '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É',
                'UPDATE_PRODUCT': '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É',
                'DELETE_PRODUCT': '–í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É',
                'UPDATE_STOCK': '–ó–º—ñ–Ω–∞ –∑–∞–ª–∏—à–∫—ñ–≤',
                'PRODUCTION': '–í–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ',
                'WRITEOFF': '–°–ø–∏—Å–∞–Ω–Ω—è',
                'WRITEOFF_BATCH': '–°–ø–∏—Å–∞–Ω–Ω—è –ø–∞—Ä—Ç—ñ—ó',
                'ARRIVAL': '–ü—Ä–∏—Ö–æ–¥',
                'CREATE_CLIENT': '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞',
                'UPDATE_CLIENT': '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞',
                'DELETE_CLIENT': '–í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞',
                'CREATE_PRODUCTION_PLAN': '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–∞–Ω—É',
                'UPDATE_PRODUCTION_PLAN': '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø–ª–∞–Ω—É',
                'CREATE_BATCH': '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–∞—Ä—Ç—ñ—ó',
                'UPDATE_BATCH': '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø–∞—Ä—Ç—ñ—ó',
                'RESERVE_BATCH': '–†–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è –ø–∞—Ä—Ç—ñ—ó'
            };
            return typeMap[type] || type;
        }

        function getOperationTypeClass(type) {
            if (type?.includes('CREATE')) return 'create';
            if (type?.includes('UPDATE')) return 'update';
            if (type?.includes('DELETE')) return 'delete';
            if (type === 'PRODUCTION') return 'production';
            if (type?.includes('WRITEOFF')) return 'writeoff';
            if (type === 'ARRIVAL') return 'arrival';
            return 'default';
        }

        function getEntityTypeText(type) {
            const typeMap = {
                'order': '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è',
                'product': '–¢–æ–≤–∞—Ä',
                'production': '–í–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ',
                'writeoff': '–°–ø–∏—Å–∞–Ω–Ω—è',
                'arrival': '–ü—Ä–∏—Ö–æ–¥',
                'client': '–ö–ª—ñ—î–Ω—Ç',
                'batch': '–ü–∞—Ä—Ç—ñ—è',
                'plan': '–ü–ª–∞–Ω'
            };
            return typeMap[type] || type;
        }

        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // –§—É–Ω–∫—Ü—ñ—è –ø–æ–∫–∞–∑—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
        function showLoading(show) {
            const tbody = document.querySelector('#operationsTable tbody');
            if (show) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="loading">
                            <div class="loading-spinner"></div>
                            <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π...</span>
                        </td>
                    </tr>
                `;
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –ø–æ–∫–∞–∑—É –ø–æ–º–∏–ª–∫–∏
        function showError(message) {
            const tbody = document.querySelector('#operationsTable tbody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="error">
                        ‚ùå ${message}
                    </td>
                </tr>
            `;
            document.getElementById('recordsCount').textContent = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è';
        }
    </script>

    <style>
        /* –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –æ–ø–µ—Ä–∞—Ü—ñ–π */
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .page-header h1 {
            font-size: 2.5em;
            margin-bottom: 0.5rem;
        }
        
        .page-header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .filters-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .stats-section {
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .datetime-cell {
            min-width: 120px;
        }

        .datetime-cell .date {
            font-weight: 500;
        }

        .datetime-cell .time {
            font-size: 0.9em;
            color: #666;
        }

        .operation-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
            text-transform: uppercase;
        }

        .operation-badge.create {
            background: #d4edda;
            color: #155724;
        }

        .operation-badge.update {
            background: #fff3cd;
            color: #856404;
        }

        .operation-badge.delete {
            background: #f8d7da;
            color: #721c24;
        }

        .operation-badge.production {
            background: #cce5ff;
            color: #004085;
        }

        .operation-badge.writeoff {
            background: #f5c6cb;
            color: #721c24;
        }

        .operation-badge.arrival {
            background: #d1ecf1;
            color: #0c5460;
        }

        .operation-badge.default {
            background: #e2e3e5;
            color: #383d41;
        }

        .entity-badge {
            background: #f8f9fa;
            color: #495057;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
        }

        .description-cell {
            max-width: 300px;
            word-wrap: break-word;
        }

        .user-cell {
            min-width: 150px;
        }

        .detail-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .detail-section:last-child {
            border-bottom: none;
        }

        .detail-section h3 {
            margin-bottom: 15px;
            color: #3498db;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .detail-item.full-width {
            grid-column: 1 / -1;
        }

        .detail-item strong {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }

        .json-data {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .modal-large {
            max-width: 900px;
        }

        .stats-overview {
            margin-bottom: 30px;
        }

        .stats-table {
            overflow-x: auto;
        }

        .table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h2 {
            margin: 0;
            color: #2c3e50;
        }

        .records-count {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .data-table th {
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: bold;
            padding: 1rem 0.75rem;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #ecf0f1;
            vertical-align: middle;
        }

        .data-table tbody tr {
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #7f8c8d;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-data {
            text-align: center;
            padding: 3rem 1rem;
            color: #7f8c8d;
            font-style: italic;
        }

        .error {
            text-align: center;
            padding: 2rem;
            color: #e74c3c;
            background: #f8d7da;
            border-radius: 4px;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .filters-section {
                grid-template-columns: 1fr;
            }
            
            .filter-actions {
                grid-column: 1;
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
            }

            .page-header h1 {
                font-size: 2em;
            }
            
            .page-header p {
                font-size: 1em;
            }
        }
  
        .filters-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .stats-section {
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .datetime-cell {
            min-width: 120px;
        }

        .datetime-cell .date {
            font-weight: 500;
        }

        .datetime-cell .time {
            font-size: 0.9em;
            color: #666;
        }

        .operation-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
            text-transform: uppercase;
        }

        .operation-badge.create {
            background: #d4edda;
            color: #155724;
        }

        .operation-badge.update {
            background: #fff3cd;
            color: #856404;
        }

        .operation-badge.delete {
            background: #f8d7da;
            color: #721c24;
        }

        .operation-badge.production {
            background: #cce5ff;
            color: #004085;
        }

        .operation-badge.writeoff {
            background: #f5c6cb;
            color: #721c24;
        }

        .operation-badge.arrival {
            background: #d1ecf1;
            color: #0c5460;
        }

        .operation-badge.default {
            background: #e2e3e5;
            color: #383d41;
        }

        .entity-badge {
            background: #f8f9fa;
            color: #495057;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
        }

        .description-cell {
            max-width: 300px;
            word-wrap: break-word;
        }

        .user-cell {
            min-width: 150px;
        }

        .detail-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .detail-section:last-child {
            border-bottom: none;
        }

        .detail-section h3 {
            margin-bottom: 15px;
            color: #3498db;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .detail-item.full-width {
            grid-column: 1 / -1;
        }

        .detail-item strong {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }

        .json-data {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .modal-large {
            max-width: 900px;
        }

        .stats-overview {
            margin-bottom: 30px;
        }

        .stats-table {
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .filters-section {
                grid-template-columns: 1fr;
            }
            
            .filter-actions {
                grid-column: 1;
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>