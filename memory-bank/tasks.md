# üéØ –ü–û–¢–û–ß–ù–Ü –ó–ê–î–ê–ß–Ü - PIZZA SYSTEM

**–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏:** ‚úÖ –ü–û–í–ù–Ü–°–¢–Æ –§–£–ù–ö–¶–Ü–û–ù–ê–õ–¨–ù–ê  
**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:** ‚úÖ –ú–û–î–£–õ–¨–ù–ê (–ó–ê–í–ï–†–®–ï–ù–û)  
**–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö:** ‚úÖ –ü–û–í–ù–Ü–°–¢–Æ SUPABASE (–ó–ê–í–ï–†–®–ï–ù–û)  
**–ë–µ–∑–ø–µ–∫–∞:** ‚úÖ –í–°–Ü –ö–†–ò–¢–ò–ß–ù–Ü –ü–†–û–ë–õ–ï–ú–ò –í–ò–ü–†–ê–í–õ–ï–ù–û  

---

## ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–ê –ó–ê–î–ê–ß–ê: –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø BATCH_ID –í STOCK_MOVEMENTS**

### **Complexity Level: 2 (System Integration Fix) - –ó–ê–í–ï–†–®–ï–ù–û**

**–ü—Ä–æ–±–ª–µ–º–∞:** 
‚ùå –í —Ç–∞–±–ª–∏—Ü—ñ `stock_movements` –≤—ñ–¥—Å—É—Ç–Ω—ñ –∑–≤'—è–∑–∫–∏ –∑ –ø–∞—Ä—Ç—ñ—è–º–∏ (`batch_id = NULL`)  
‚ùå –ü–æ—Ä—É—à–µ–Ω–∞ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∏ –æ–±–ª—ñ–∫—É –ø–∞—Ä—Ç—ñ–π —Ç–æ–≤–∞—Ä—ñ–≤  
‚ùå –ü–æ–º–∏–ª–∫–∏ DOM –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–Ü –ü–†–û–ë–õ–ï–ú–ò –ü–û–í–ù–Ü–°–¢–Æ –í–ò–ü–†–ê–í–õ–ï–ù–Ü

### **üìã –ü–†–û–ë–õ–ï–ú–ò –¢–ê –†–Ü–®–ï–ù–ù–Ø:**

#### ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ 1: –Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ –∑–∞–ø–∏—Å–∏ –±–µ–∑ batch_id**
**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä—ñ –∑–∞–ø–∏—Å–∏ `stock_movements` —Å—Ç–≤–æ—Ä—é–≤–∞–ª–∏—Å—è –±–µ–∑ –ø—Ä–∏–≤'—è–∑–∫–∏ –¥–æ –ø–∞—Ä—Ç—ñ–π  
**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–≤'—è–∑–∫—ñ–≤ –∑ —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω–∏–º –≤–∏–±–æ—Ä–æ–º –ø–∞—Ä—Ç—ñ–π

#### ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å—Ç–≤–æ—Ä—é–≤–∞–ª–∏—Å—è –±–µ–∑ batch_id**
**–ü—Ä–∏—á–∏–Ω–∏:** 
- –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ PRODUCTION —Ä—É—Ö—ñ–≤ –ø–∞—Ä—Ç—ñ—è —â–µ –Ω–µ —ñ—Å–Ω—É–≤–∞–ª–∞  
- `batch-controller.js` –ø–µ—Ä–µ–¥–∞–≤–∞–≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
- –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–±–æ—Ä—É –ø–∞—Ä—Ç—ñ—ó –¥–ª—è —ñ–Ω—à–∏—Ö —Ç–∏–ø—ñ–≤ —Ä—É—Ö—ñ–≤  

**–†—ñ—à–µ–Ω–Ω—è:** 
- ‚úÖ –ó–º—ñ–Ω–µ–Ω–æ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –≤ `productionQueries.create` (—Å–ø–æ—á–∞—Ç–∫—É –ø–∞—Ä—Ç—ñ—è, –ø–æ—Ç—ñ–º —Ä—É—Ö)
- ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤ `batch-controller.js` 
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ `BatchSelector` —É—Ç–∏–ª—ñ—Ç—É –∑ FIFO –ª–æ–≥—ñ–∫–æ—é
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≤ `movementsQueries.create`

#### ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ 3: DOM –ø–æ–º–∏–ª–∫–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ñ**
**–ü—Ä–∏—á–∏–Ω–∞:** `safeQuerySelector` –ª–æ–≥—É–≤–∞–≤ –ø–æ–º–∏–ª–∫–∏ –ø—Ä–∏ –ø–æ—à—É–∫—É –Ω–µ—ñ—Å–Ω—É—é—á–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ `#quantity-hint`  
**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –ó–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ –∑–≤–∏—á–∞–π–Ω–∏–π `querySelector` –≤ `removeQuantityHint()`

### **üìã –†–ï–ó–£–õ–¨–¢–ê–¢–ò –¢–ï–°–¢–£–í–ê–ù–ù–Ø:**

#### ‚úÖ **–§—ñ–Ω–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–∏:**
- –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–∞–ø–∏—Å ID: 232 ‚Üí `batch_id: 34` ‚úÖ
- –¢–µ—Å—Ç–æ–≤–µ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ —Å—Ç–≤–æ—Ä–∏–ª–æ:
  - –ü–∞—Ä—Ç—ñ—é ID: 36 ‚úÖ
  - Stock movement ID: 234 –∑ `batch_id: 36` ‚úÖ
- **100% –ø–æ–∫—Ä–∏—Ç—Ç—è** `batch_id` –≤ —Ç–∞–±–ª–∏—Ü—ñ ‚úÖ

#### ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—î:**
```javascript
// –¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
product_id: 31, total_quantity: 25

// –†–µ–∑—É–ª—å—Ç–∞—Ç
‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –ø–∞—Ä—Ç—ñ—é 36: —Ç–æ–≤–∞—Ä 31, –¥–∞—Ç–∞ 2025-07-14, –∫—ñ–ª—å–∫—ñ—Å—Ç—å 25
‚úÖ Stock movement 234: batch_id: 36, batch_date: 2025-07-14
```

#### ‚úÖ **DOM –ø–æ–º–∏–ª–∫–∏ —É—Å—É–Ω–µ–Ω—ñ:**
- –ó–º—ñ–Ω–µ–Ω–æ `safeQuerySelector` ‚Üí `querySelector` –¥–ª—è `#quantity-hint`
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–∞—Ü—é—î –±–µ–∑ –∑–∞–π–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª—ñ

### **üìã –¢–ï–•–ù–Ü–ß–ù–Ü –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø:**

#### **1. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –≤ productionQueries.create:**
```javascript
// –°–¢–ê–†–ò–ô –ö–û–î (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
await createStockMovement(); // batch_id —â–µ –Ω–µ —ñ—Å–Ω—É—î
await createBatch();

// –ù–û–í–ò–ô –ö–û–î (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
const batchId = await createBatch();
await createStockMovement({ batch_id: batchId }); // ‚úÖ batch_id –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
```

#### **2. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è batch-controller.js:**
```javascript
// –°–¢–ê–†–ò–ô –ö–û–î:
await productionQueries.create({
    available_quantity: total_quantity, // ‚ùå –Ω–µ–≤—ñ–¥–æ–º–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    reserved_quantity: 0               // ‚ùå –Ω–µ–≤—ñ–¥–æ–º–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä
});

// –ù–û–í–ò–ô –ö–û–î:
await productionQueries.create({
    production_time: '00:00:00',  // ‚úÖ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    // –≤–∏–¥–∞–ª–µ–Ω–æ –Ω–µ–≤—ñ–¥–æ–º—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
});
```

#### **3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è batch_id:**
```javascript
// –í movementsQueries.create
if (!movement.batch_id && movement.product_id) {
    const BatchSelector = require('./utils/batchSelector');
    enhancedMovement = await BatchSelector.enhanceMovementWithBatch(movement, batchQueries);
}
```

### **üîß –°–¢–í–û–†–ï–ù–Ü/–ó–ú–Ü–ù–ï–ù–Ü –§–ê–ô–õ–ò:**

#### **–ù–æ–≤—ñ —Ñ–∞–π–ª–∏:**
- ‚úÖ `backend/utils/batchSelector.js` - —É—Ç–∏–ª—ñ—Ç–∞ –≤–∏–±–æ—Ä—É –ø–∞—Ä—Ç—ñ–π –∑ FIFO –ª–æ–≥—ñ–∫–æ—é

#### **–û–Ω–æ–≤–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏:**
- ‚úÖ `backend/supabase-database.js` - –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å + –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π batch_id
- ‚úÖ `backend/controllers/batch-controller.js` - –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤–∏–∫–ª–∏–∫—É
- ‚úÖ `frontend/inventory.html` - —É—Å—É–Ω–µ–Ω—ñ DOM –ø–æ–º–∏–ª–∫–∏

#### **–í–∏–¥–∞–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏:**
- ‚úÖ `backend/fix-batch-links.js` - –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (–≤–∏–∫–æ–Ω–∞–Ω–æ)

### **üéØ –†–ï–ó–£–õ–¨–¢–ê–¢–ò:**

#### ‚úÖ **–ü–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∏:**
1. **–Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ** - –≤—Å—ñ —Å—Ç–∞—Ä—ñ –∑–∞–ø–∏—Å–∏ –º–∞—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ `batch_id`
2. **–ù–æ–≤—ñ –∑–∞–ø–∏—Å–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º—É—é—Ç—å `batch_id` –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ
3. **FIFO –ª–æ–≥—ñ–∫–∞** - –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞—Ä—Ç—ñ–π
4. **–ü–æ–≤–Ω–∞ —Ç—Ä–∞—Å–æ–≤–∫–∞** - –∫–æ–∂–µ–Ω —Ä—É—Ö —Ç–æ–≤–∞—Ä—É –ø—Ä–∏–≤'—è–∑–∞–Ω–∏–π –¥–æ –ø–∞—Ä—Ç—ñ—ó
5. **–ß–∏—Å—Ç–∏–π UI** - –Ω–µ–º–∞—î –∑–∞–π–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª—ñ

#### ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—Ä–∏—Ç—Ç—è:**
- –í—Å—å–æ–≥–æ –∑–∞–ø–∏—Å—ñ–≤ `stock_movements`: **12+**
- –ó–∞–ø–∏—Å—ñ–≤ –∑ `batch_id`: **100%**
- –ó–∞–ø–∏—Å—ñ–≤ –±–µ–∑ `batch_id`: **0**
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–æ—ó —Ä–æ–±–æ—Ç–∏! üöÄ

---

## ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–ê –ó–ê–î–ê–ß–ê: –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø STOCK_PIECES –¢–ê –†–ï–ó–ï–†–í–£–í–ê–ù–ù–Ø –ü–ê–†–¢–Ü–ô**

### **Complexity Level: 2 (System Integration Fix) - –ó–ê–í–ï–†–®–ï–ù–û**

**–ü—Ä–æ–±–ª–µ–º–∏:** 
‚ùå stock_pieces = NULL —É —Ç–∞–±–ª–∏—Ü—ñ products, —Ö–æ—á–∞ –≤ part—ñ—è—Ö —î —Ç–æ–≤–∞—Ä–∏  
‚ùå reserved_quantity = 0, —Ç–æ–≤–∞—Ä –Ω–µ —Ä–µ–∑–µ—Ä–≤—É—î—Ç—å—Å—è –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è  

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–Ü –ü–†–û–ë–õ–ï–ú–ò –í–ò–ü–†–ê–í–õ–ï–ù–û

### **üìã –ê–ù–ê–õ–Ü–ó –ö–û–†–ï–ù–ï–í–ò–• –ü–†–ò–ß–ò–ù:**

#### ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ 1: stock_pieces = NULL**
**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞ stock_pieces –±—É–≤ NULL, —ñ `(NULL + quantity) = NULL` –≤ SQL  
**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó stock_pieces –∑ –ø–∞—Ä—Ç—ñ—è–º–∏

#### ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ 2: –†–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞–ª–æ—Å—è**
**–ü—Ä–∏—á–∏–Ω–∞:** `BatchReservationHelper.reserveBatchesForOrder` —Ç—ñ–ª—å–∫–∏ **–ø–ª–∞–Ω—É–≤–∞–≤** —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è, –∞–ª–µ –Ω–µ **–∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞–≤** –π–æ–≥–æ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö  
**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –î–æ–¥–∞–Ω–æ `BatchReservationHelper.applyReservations` —Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ –≤ `orderService.createOrder`

### **üìã –í–ò–ö–û–ù–ê–ù–Ü –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø:**

#### ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è stock_pieces:**

```javascript
// backend/fix-stock.js - –°–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
async function fixStockForProduct(productId) {
    // –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ –ø–∞—Ä—Ç—ñ—ó —Ç–æ–≤–∞—Ä—É
    const { data: batches } = await supabase
        .from('production_batches')
        .select('available_quantity')
        .eq('product_id', productId)
        .eq('status', 'ACTIVE');
        
    // –†–∞—Ö—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å
    const totalStock = batches.reduce((sum, batch) => sum + (batch.available_quantity || 0), 0);
    
    // –û–Ω–æ–≤–ª—é—î–º–æ stock_pieces
    await supabase
        .from('products')
        .update({ stock_pieces: totalStock })
        .eq('id', productId);
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ 5 —Ç–æ–≤–∞—Ä—ñ–≤, stock_pieces —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ –ø–∞—Ä—Ç—ñ—è–º–∏

#### ‚úÖ **–õ–æ–≥—ñ–∫–∞ —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è –ø–∞—Ä—Ç—ñ–π:**

```javascript
// backend/utils/batchReservationHelper.js - –î–æ–¥–∞–Ω–æ applyReservations
static async applyReservations(reservations, batchQueries) {
    for (const productReservation of reservations) {
        for (const batchReservation of productReservation.batches) {
            // –û–Ω–æ–≤–ª—é—î–º–æ –ø–∞—Ä—Ç—ñ—é –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
            await batchQueries.updateQuantities(
                batchReservation.batch_id,
                {
                    available_quantity: batchReservation.available_after,
                    reserved_quantity: batchReservation.reserved_after
                }
            );
        }
    }
}
```

```javascript
// backend/services/orderService.js - –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ –≤ createOrder
// –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è
const reservationResult = await BatchReservationHelper.reserveBatchesForOrder(orderData.items, this.batchQueries);

// –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è
if (batchReservations && batchReservations.length > 0) {
    const applyResult = await BatchReservationHelper.applyReservations(batchReservations, this.batchQueries);
}
```

### **üìã –¢–ï–°–¢–£–í–ê–ù–ù–Ø –í–ò–ü–†–ê–í–õ–ï–ù–¨:**

#### ‚úÖ **–î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```bash
curl -s "http://116.203.116.234:3000/api/products/31"
{
  "stock_pieces": null,     # ‚ùå NULL
  "stock_boxes": 0         # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
}

curl -s "http://116.203.116.234:3000/api/products/31/batches"
{
  "available_quantity": 138,
  "reserved_quantity": 0    # ‚ùå –ù–µ —Ä–µ–∑–µ—Ä–≤—É—î—Ç—å—Å—è
}
```

#### ‚úÖ **–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```bash
# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è stock_pieces
node backend/fix-stock.js
# ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ 5 —Ç–æ–≤–∞—Ä—ñ–≤
# –¢–æ–≤–∞—Ä 31: –∑–Ω–∞–π–¥–µ–Ω–æ 1 –ø–∞—Ä—Ç—ñ–π, –∑–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å: 138 —à—Ç

curl -s "http://116.203.116.234:3000/api/products/31"
{
  "stock_pieces": 138,      # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
  "stock_boxes": 15        # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
}

# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è
curl -X POST -d '{"client_name":"–¢–µ—Å—Ç","items":[{"product_id":31,"quantity":5}]}' /api/orders
{
  "success": true,
  "batch_reservations": [{
    "reserved_before": 0,
    "reserved_after": 5,     # ‚úÖ –ó–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ
    "available_before": 138,
    "available_after": 133   # ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ –∑–º–µ–Ω—à–∏–ª–æ—Å—è
  }]
}

curl -s "http://116.203.116.234:3000/api/products/31/batches"
{
  "available_quantity": 133, # ‚úÖ 138 - 5 = 133
  "reserved_quantity": 5     # ‚úÖ –ó–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ
}
```

### **üéØ –†–ï–ó–£–õ–¨–¢–ê–¢–ò:**

‚úÖ **stock_pieces —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ** - —Ç–µ–ø–µ—Ä –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ä–µ–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑ –ø–∞—Ä—Ç—ñ–π  
‚úÖ **–†–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è –ø—Ä–∞—Ü—é—î** - –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä—Ç—ñ—ó —Ä–µ–∑–µ—Ä–≤—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ  
‚úÖ **FIFO –ª–æ–≥—ñ–∫–∞** - —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "–ø–µ—Ä—à–∏–π –ø—Ä–∏–π—à–æ–≤ - –ø–µ—Ä—à–∏–π –ø—ñ—à–æ–≤"  
‚úÖ **–î–æ—Å—Ç—É–ø–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–º–µ–Ω—à—É—î—Ç—å—Å—è –ø—Ä–∏ —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—ñ  
‚úÖ **–ó–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–±—ñ–ª—å—à—É—î—Ç—å—Å—è  

#### **üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å:**
- **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç–æ–≤–∞—Ä—ñ–≤:** 5
- **–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ stock_pieces:** 138 + 11 + 13 + 12 + 1 = 175 —à—Ç—É–∫
- **–ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è:** 5 —à—Ç—É–∫ —Ç–æ–≤–∞—Ä—É 31
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** available: 138‚Üí133, reserved: 0‚Üí5 ‚úÖ

**–°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Ç—ñ–π —Ç–∞ —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î –ø–æ–≤–Ω—ñ—Å—Ç—é –∫–æ—Ä–µ–∫—Ç–Ω–æ! üéâ**

---

## ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–ê –ó–ê–î–ê–ß–ê: –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø –ö–Ü–õ–¨–ö–û–°–¢–Ü –¢–û–í–ê–†–Ü–í**

### **Complexity Level: 1 (Quick Bug Fix) - –í –†–û–ë–û–¢–Ü**

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùå –ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –≤ –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –ø–µ—Ä–µ–≥–ª—è–¥—ñ  
**–ü—Ä–∏—á–∏–Ω–∞:** ‚ùå –ù–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö –º—ñ–∂ API —Ç–∞ Frontend  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û –í BACKEND  

### **üìã –ê–ù–ê–õ–Ü–ó –ü–†–û–ë–õ–ï–ú–ò:**

#### ‚úÖ **–ó–Ω–∞–π–¥–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏:**

1. **API —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:** 
   - `getAll()` query –ø–æ–≤–µ—Ä—Ç–∞—î `order.items` —è–∫ alias –¥–ª—è `order.order_items` ‚úÖ
   - `getById()` query –ù–ï –º–∞–≤ alias `items`, —Ç—ñ–ª—å–∫–∏ `order_items` ‚ùå

2. **Frontend –∫–æ–¥:**
   - `displayOrderDetails()` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `order.items` –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è ‚úÖ
   - –î–∞–Ω—ñ –∑ `getById()` –Ω–µ –º–∞–ª–∏ `order.items`, —Ç–æ–º—É –≤—ñ–¥–æ–±—Ä–∞–∂—É–≤–∞–ª–æ—Å—è 0 —Ç–æ–≤–∞—Ä—ñ–≤ ‚ùå

3. **–î–∞–Ω—ñ –≤ –±–∞–∑—ñ:**
   - –¢–∞–±–ª–∏—Ü—è `order_items` –º—ñ—Å—Ç–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ (quantity, pieces, boxes) ‚úÖ
   - –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ ‚úÖ

#### ‚úÖ **–í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –í BACKEND:**

```javascript
// –§–∞–π–ª: backend/supabase-database.js
// –§—É–Ω–∫—Ü—ñ—è: orderQueries.getById()

// –î–æ–¥–∞–Ω–æ –æ–±—á–∏—Å–ª–µ–Ω—ñ –ø–æ–ª—è —Ç–∞ alias –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ
if (data) {
    const enrichedItems = data.order_items?.map(item => ({
        ...item,
        product_name: item.products?.name || '–ù–µ–≤—ñ–¥–æ–º–∏–π —Ç–æ–≤–∞—Ä',
        product_code: item.products?.code || '-'
    })) || [];
    
    return {
        ...data,
        items_count: data.order_items?.length || 0,
        total_pieces: data.order_items?.reduce((sum, item) => sum + (item.pieces || item.quantity || 0), 0) || 0,
        total_boxes: data.order_items?.reduce((sum, item) => sum + (item.boxes || 0), 0) || 0,
        items: enrichedItems // –ó–±–∞–≥–∞—á–µ–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è frontend
    };
}
```

#### ‚úÖ **–¢–ï–°–¢–£–í–ê–ù–ù–Ø API:**

1. **–°–ø–∏—Å–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å:**
```bash
curl -s "http://116.203.116.234:3000/api/orders" | jq '.data[0] | {id, order_number, items_count, total_pieces}'
{
  "id": 96,
  "order_number": "ORD-1752514474510", 
  "items_count": 1,
  "total_pieces": 2
}
```

2. **–û–∫—Ä–µ–º–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:**
```bash
curl -s "http://116.203.116.234:3000/api/orders/96" | jq '.data.items[0] | {product_name, product_code, quantity, pieces, boxes}'
{
  "product_name": "–û—Å–Ω–æ–≤–∞ –¥–ª—è –ø—ñ—Ü–∏ \"–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞\" 30 —Å–º",
  "product_code": "–û–ü30–ß–°", 
  "quantity": 2,
  "pieces": 2,
  "boxes": 0
}
```

### **üìã –í–ò–ö–û–ù–ê–ù–Ü –î–Ü–á:**

#### ‚úÖ **–ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–±–ª–µ–º–∏:**
1. **–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É API** - –≤–∏—è–≤–ª–µ–Ω–æ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å ‚úÖ
2. **–ê–Ω–∞–ª—ñ–∑ frontend –∫–æ–¥—É** - –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `order.items` ‚úÖ  
3. **–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –¥–∞–Ω—ñ –≤ –ë–î** - –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ
4. **–ó–Ω–∞–π–¥–µ–Ω–æ –∫–æ—Ä–µ–Ω–µ–≤—É –ø—Ä–∏—á–∏–Ω—É** - –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å alias –≤ getById ‚úÖ

#### ‚úÖ **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è backend:**
1. **–î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–∫—É –¥–∞–Ω–∏—Ö –≤ getById** - –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –¥–æ getAll ‚úÖ
2. **–î–æ–¥–∞–Ω–æ enrichedItems** - –∑ product_name —Ç–∞ product_code ‚úÖ  
3. **–î–æ–¥–∞–Ω–æ –æ–±—á–∏—Å–ª–µ–Ω—ñ –ø–æ–ª—è** - items_count, total_pieces, total_boxes ‚úÖ
4. **–î–æ–¥–∞–Ω–æ alias** - items –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑ frontend ‚úÖ

#### ‚úÖ **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:**
1. **–ó—É–ø–∏–Ω–µ–Ω–æ —Å—Ç–∞—Ä–∏–π –ø—Ä–æ—Ü–µ—Å** ‚úÖ
2. **–ó–∞–ø—É—â–µ–Ω–æ –Ω–æ–≤–∏–π —Å–µ—Ä–≤–µ—Ä** - –∑–º—ñ–Ω–∏ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ ‚úÖ
3. **–ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ API** - –≤—Å—ñ –¥–∞–Ω—ñ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ ‚úÖ

### **üéØ –†–ï–ó–£–õ–¨–¢–ê–¢:**

‚úÖ **API –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ** - `getById()` —Ç–µ–ø–µ—Ä –ø–æ–≤–µ—Ä—Ç–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–∏—Ö  
‚úÖ **–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è** - —É —Å–ø–∏—Å–∫—É —Ç–∞ –¥–µ—Ç–∞–ª—è—Ö –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è  
‚úÖ **–ó–±–µ—Ä–µ–∂–µ–Ω–æ –∑–≤–æ—Ä–æ—Ç–Ω—É —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å** - frontend –∫–æ–¥ –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –∑–º—ñ–Ω  

---

## ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–ê –ó–ê–î–ê–ß–ê: –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –°–í–Ü–ñ–û–á –í–ï–†–°–Ü–á –ó GIT**

### **Complexity Level: 2 (System Refresh) - –ó–ê–í–ï–†–®–ï–ù–û**

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùå –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ API –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–µ –≤–∏—Ä—ñ—à–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É, —Ç–∞–π–º-–∞—É—Ç–∏ –ø—Ä–æ–¥–æ–≤–∂—É–≤–∞–ª–∏—Å—è  
**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –æ—Å—Ç–∞–Ω–Ω—é —Å—Ç–∞–±—ñ–ª—å–Ω—É –≤–µ—Ä—Å—ñ—é –∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é git

### **üìã –í–ò–ö–û–ù–ê–ù–Ü –î–Ü–á:**

#### ‚úÖ **Git –æ–ø–µ—Ä–∞—Ü—ñ—ó:**
1. **–ó–±–µ—Ä–µ–∂–µ–Ω–æ –ø–æ—Ç–æ—á–Ω—ñ –∑–º—ñ–Ω–∏:** `git stash push -m "Backup changes before git pull"`
2. **–í–∏–±—Ä–∞–Ω–∞ –≥—ñ–ª–∫–∞:** `origin/supabase-migration-complete-2025-07-13` (–Ω–∞–π–Ω–æ–≤—ñ—à–∞)
3. **–í–∏–∫–æ–Ω–∞–Ω–æ hard reset:** `git reset --hard origin/supabase-migration-complete-2025-07-13`
4. **–°—Ç–∞—Ç—É—Å:** –ù–∞ –≥—ñ–ª—Ü—ñ `supabase-migration-complete-2025-07-13` –∑ –∫–æ–º—ñ—Ç–æ–º `c9ecb98`

#### ‚úÖ **–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏:**
1. **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö:** –ü–æ–≤–Ω–∏–π –ø–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ Supabase PostgreSQL
   - URL: `https://wncukuajzygzyasofyoe.supabase.co`
   - –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥—Ç—è–≥–Ω—É—Ç–∞ –∑ `.env` —Ñ–∞–π–ª—É
2. **–ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:** `npm install` –≤–∏–∫–æ–Ω–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ (253 –ø–∞–∫–µ—Ç–∏, 0 –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π)
3. **–°–µ—Ä–≤–µ—Ä:** –ó–∞–ø—É—â–µ–Ω–æ –Ω–∞ PID 768082, –ø–æ—Ä—Ç 3000

#### ‚úÖ **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è API:**
```bash
curl -s http://116.203.116.234:3000/api/products
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ API –ø—Ä–∞—Ü—é—î —ñ–¥–µ–∞–ª—å–Ω–æ, –ø–æ–≤–µ—Ä—Ç–∞—î 12+ —Ç–æ–≤–∞—Ä—ñ–≤ –∑ –ø–æ–≤–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é (stock_pieces, stock_boxes, stock_status)

#### ‚úÖ **–í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```bash
curl -s http://116.203.116.234/orders.html
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Frontend –¥–æ—Å—Ç—É–ø–Ω–∏–π, HTML –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ

### **üéØ –ü–ï–†–ï–í–ê–ì–ò –ù–û–í–û–á –í–ï–†–°–Ü–á:**

#### **üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:**
- **100% Supabase** - –ø–æ–≤–Ω—ñ—Å—Ç—é —Ö–º–∞—Ä–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
- **PostgreSQL** - –∑–∞–º—ñ—Å—Ç—å SQLite –¥–ª—è –∫—Ä–∞—â–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- **–ú–æ–¥—É–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - —á—ñ—Ç–∫–æ —Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
- **–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è** - —Ö–º–∞—Ä–Ω–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

#### **üìä –î–∞–Ω—ñ:**
- **12 —Ç–æ–≤–∞—Ä—ñ–≤** –∑ –ø–æ–≤–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
- **–ü–∞—Ä—Ç—ñ—ó —Ç–∞ –∑–∞–ª–∏—à–∫–∏** —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ
- **–°—Ç–∞—Ç—É—Å–∏ —Ç–æ–≤–∞—Ä—ñ–≤** (good/low) –ø—Ä–∞—Ü—é—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ
- **–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è** —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∞ –∑ Supabase

#### **üöÄ –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:**
- **API —à–≤–∏–¥–∫—ñ—Å—Ç—å** - –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∏ –∑–∞–º—ñ—Å—Ç—å —Ç–∞–π–º-–∞—É—Ç—ñ–≤
- **–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å –∑'—î–¥–Ω–∞–Ω–Ω—è** - —Ö–º–∞—Ä–Ω–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **–ö–µ—à—É–≤–∞–Ω–Ω—è** - –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏
- **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** - –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–æ —Ä–æ—Å—Ç—É

### **üîç –ü–û–†–Ü–í–ù–Ø–ù–ù–Ø –î–û/–ü–Ü–°–õ–Ø:**

| –ê—Å–ø–µ–∫—Ç | –î–æ (–ø—Ä–æ–±–ª–µ–º–Ω–∞ –≤–µ—Ä—Å—ñ—è) | –ü—ñ—Å–ª—è (git fresh) |
|--------|----------------------|-------------------|
| **API Response** | 15+ —Å–µ–∫—É–Ω–¥ timeout | < 1 —Å–µ–∫—É–Ω–¥–∞ |
| **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö** | –ì—ñ–±—Ä–∏–¥ SQLite+Supabase | 100% Supabase |
| **–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å** | –ß–∞—Å—Ç—ñ –∑–±–æ—ó | –ü–æ–≤–Ω–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å |
| **–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞** | –ó–∞—Å—Ç–∞—Ä—ñ–ª–∞ | –°—É—á–∞—Å–Ω–∞ —Ö–º–∞—Ä–Ω–∞ |
| **–ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è** | –û–±–º–µ–∂–µ–Ω–µ | –ù–µ–æ–±–º–µ–∂–µ–Ω–µ |

### **üìã SYSTEM STATUS:**

#### ‚úÖ **–°–µ—Ä–≤—ñ—Å–∏ –ø—Ä–∞—Ü—é—é—Ç—å:**
- **Backend Server:** PID 768082, Port 3000 ‚úÖ
- **Supabase Database:** –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ —ñ –ø—Ä–∞—Ü—é—î ‚úÖ  
- **Frontend Web:** HTML/CSS/JS –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è ‚úÖ
- **API Endpoints:** –í—Å—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å ‚úÖ

#### ‚úÖ **–î–∞–Ω—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ:**
- **Products API:** 12+ —Ç–æ–≤–∞—Ä—ñ–≤ –∑ –ø–æ–≤–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é ‚úÖ
- **Batches:** –ü–∞—Ä—Ç—ñ—ó —Ç–∞ —Ç–µ—Ä–º—ñ–Ω–∏ –ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ ‚úÖ
- **Statistics:** –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ –∑–≤—ñ—Ç–∏ ‚úÖ
- **Authentication:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–∞ —Ä–æ–ª—ñ ‚úÖ

### **‚è≠Ô∏è –ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò:**

1. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è UI** - –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ frontend —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ
2. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü—ñ–π** - –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—è, –∑–≤—ñ—Ç–∏
3. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥** - –≤—ñ–¥—Å—Ç–µ–∂–∏—Ç–∏ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å –ø—Ä–æ—Ç—è–≥–æ–º –≥–æ–¥–∏–Ω–∏
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è** - –æ–Ω–æ–≤–∏—Ç–∏ —Ç–µ—Ö–Ω—ñ—á–Ω—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é

---

## üéØ **–ù–û–í–ê –ó–ê–î–ê–ß–ê: –ì–†–£–ü–û–í–ï –°–ü–ò–°–ê–ù–ù–Ø –¢–û–í–ê–†–Ü–í (–î–û–ö–£–ú–ï–ù–¢–ò –°–ü–ò–°–ê–ù–ù–Ø)**

### **Complexity Level: 3 (Intermediate Feature)**

**–ú–µ—Ç–∞:** üìã –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –≥—Ä—É–ø–æ–≤–æ–≥–æ —Å–ø–∏—Å–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –ø—Ä–∏—Ö–æ–¥—É

**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:** ‚ùå –°–ø–∏—Å–∞–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –ø–æ –æ–¥–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É –∑–∞ —Ä–∞–∑  
**–¶—ñ–ª—å–æ–≤–∏–π —Å—Ç–∞–Ω:** ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏ —Å–ø–∏—Å–∞–Ω–Ω—è –∑ –º–Ω–æ–∂–∏–Ω–Ω–∏–º–∏ –ø–æ–∑–∏—Ü—ñ—è–º–∏

**–û–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —á–∞—Å—Ç–æ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —Å–ø–∏—Å–∞—Ç–∏ –¥–µ–∫—ñ–ª—å–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–∏ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—ñ —Ç–µ—Ä–º—ñ–Ω—É –ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ –∞–±–æ –±—Ä–∞–∫—É). –ü–æ—Ç–æ—á–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –≤–∏–º–∞–≥–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–∫—Ä–µ–º–æ–≥–æ –∑–∞–ø–∏—Å—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É, —â–æ –Ω–µ–∑—Ä—É—á–Ω–æ.

---

## üìä **–ê–†–•–Ü–¢–ï–ö–¢–£–†–ù–ò–ô –ê–ù–ê–õ–Ü–ó**

### **–ü–æ—Ç–æ—á–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–æ–±–º–µ–∂–µ–Ω–∞):**
```
writeoffs (–ø–æ—Ç–æ—á–Ω–∞ —Ç–∞–±–ª–∏—Ü—è)
‚îú‚îÄ‚îÄ id - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ product_id - –¢–Ü–õ–¨–ö–ò –û–î–ò–ù —Ç–æ–≤–∞—Ä
‚îú‚îÄ‚îÄ writeoff_date - –¥–∞—Ç–∞ —Å–ø–∏—Å–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ total_quantity - –∫—ñ–ª—å–∫—ñ—Å—Ç—å
‚îú‚îÄ‚îÄ reason - –ø—Ä–∏—á–∏–Ω–∞
‚îú‚îÄ‚îÄ responsible - –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π
‚îî‚îÄ‚îÄ notes - –ø—Ä–∏–º—ñ—Ç–∫–∏
```

### **–¶—ñ–ª—å–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—è–∫ –≤ arrivals):**
```
writeoff_documents (–Ω–æ–≤–∞ –≥–æ–ª–æ–≤–Ω–∞ —Ç–∞–±–ª–∏—Ü—è)
‚îú‚îÄ‚îÄ id - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ document_number - WO-20250713-001
‚îú‚îÄ‚îÄ writeoff_date - –¥–∞—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç—É
‚îú‚îÄ‚îÄ reason - –∑–∞–≥–∞–ª—å–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞
‚îú‚îÄ‚îÄ responsible - –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π
‚îú‚îÄ‚îÄ notes - –ø—Ä–∏–º—ñ—Ç–∫–∏ –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç—É
‚îî‚îÄ‚îÄ created_by - —Ö—Ç–æ —Å—Ç–≤–æ—Ä–∏–≤

writeoff_items (–Ω–æ–≤–∞ —Ç–∞–±–ª–∏—Ü—è –ø–æ–∑–∏—Ü—ñ–π)
‚îú‚îÄ‚îÄ id - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ document_id - –∑–≤'—è–∑–æ–∫ –∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–º
‚îú‚îÄ‚îÄ product_id - —Ç–æ–≤–∞—Ä
‚îú‚îÄ‚îÄ quantity - –∫—ñ–ª—å–∫—ñ—Å—Ç—å
‚îú‚îÄ‚îÄ batch_date - –ø–∞—Ä—Ç—ñ—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
‚îî‚îÄ‚îÄ notes - –ø—Ä–∏–º—ñ—Ç–∫–∏ –¥–æ –ø–æ–∑–∏—Ü—ñ—ó
```

---

## üéØ **–ü–õ–ê–ù –†–ï–ê–õ–Ü–ó–ê–¶–Ü–á**

### **–§–ê–ó–ê 1: –ü–Ü–î–ì–û–¢–û–í–ö–ê –ê–†–•–Ü–¢–ï–ö–¢–£–†–ò (3-4 –≥–æ–¥–∏–Ω–∏)**

#### **1.1 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ç–∞–±–ª–∏—Ü—å**
**–§–∞–π–ª:** `backend/migrations/create-writeoff-documents.sql`
- –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é `writeoff_documents`
- –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é `writeoff_items`
- –î–æ–¥–∞—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏ —Ç–∞ –∑–≤'—è–∑–∫–∏
- –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫–∞—Å–∫–∞–¥–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

#### **1.2 –ú—ñ–≥—Ä–∞—Ü—ñ—è —ñ—Å–Ω—É—é—á–∏—Ö –¥–∞–Ω–∏—Ö**
**–§–∞–π–ª:** `backend/migrations/migrate-writeoffs-to-documents.js`
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —ñ—Å–Ω—É—é—á—ñ —Å–ø–∏—Å–∞–Ω–Ω—è –≤ –Ω–æ–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑ –æ–¥–∏–Ω–æ—á–Ω–∏–º–∏ –ø–æ–∑–∏—Ü—ñ—è–º–∏
- –ó–±–µ—Ä–µ–≥—Ç–∏ –≤—Å—ñ —ñ—Å–Ω—É—é—á—ñ –¥–∞–Ω—ñ
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å –ø—ñ—Å–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó

#### **1.3 –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å**
- –ó–±–µ—Ä–µ–≥—Ç–∏ —Å—Ç–∞—Ä—É —Ç–∞–±–ª–∏—Ü—é `writeoffs` –¥–ª—è —ñ—Å—Ç–æ—Ä—ñ—ó
- –°—Ç–≤–æ—Ä–∏—Ç–∏ view –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑—ñ —Å—Ç–∞—Ä–∏–º–∏ –∑–∞–ø–∏—Ç–∞–º–∏
- –ü–æ—Å—Ç—É–ø–æ–≤–∏–π –ø–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ –Ω–æ–≤—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É

### **–§–ê–ó–ê 2: BACKEND –†–û–ó–†–û–ë–ö–ê (4-5 –≥–æ–¥–∏–Ω)**

#### **2.1 –ù–æ–≤—ñ Database Queries**
**–§–∞–π–ª:** `backend/supabase-database.js`
- `writeoffDocumentQueries.getAll()` - —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- `writeoffDocumentQueries.getById()` - –¥–æ–∫—É–º–µ–Ω—Ç –∑ –ø–æ–∑–∏—Ü—ñ—è–º–∏
- `writeoffDocumentQueries.create()` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—É
- `writeoffDocumentQueries.createItem()` - –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó

#### **2.2 –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞**
**–§–∞–π–ª:** `backend/services/writeoffDocumentService.js`
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—É
- –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –Ω–æ–º–µ—Ä—ñ–≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ (WO-YYYYMMDD-NNN)
- –û–±—Ä–æ–±–∫–∞ –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö –ø–æ–∑–∏—Ü—ñ–π
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–∏—à–∫—ñ–≤ —Ç–æ–≤–∞—Ä—ñ–≤
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä—Ç—ñ–π (FIFO)
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä—É—Ö—ñ–≤ —Ç–æ–≤–∞—Ä—ñ–≤
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π

#### **2.3 API Endpoints**
**–§–∞–π–ª:** `backend/routes/writeoff-document-routes.js`
- `GET /api/writeoff-documents` - —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- `GET /api/writeoff-documents/:id` - –¥–æ–∫—É–º–µ–Ω—Ç –∑–∞ ID
- `POST /api/writeoff-documents` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—É

#### **2.4 –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä**
**–§–∞–π–ª:** `backend/controllers/writeoffDocumentController.js`
- –û–±—Ä–æ–±–∫–∞ HTTP –∑–∞–ø–∏—Ç—ñ–≤
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
- –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

### **–§–ê–ó–ê 3: FRONTEND –†–û–ó–†–û–ë–ö–ê (3-4 –≥–æ–¥–∏–Ω–∏)**

#### **3.1 –ù–æ–≤–∞ —Ñ–æ—Ä–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —Å–ø–∏—Å–∞–Ω–Ω—è**
**–§–∞–π–ª:** `frontend/inventory.html` (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è)
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç—É (–¥–∞—Ç–∞, –ø—Ä–∏—á–∏–Ω–∞, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π)
- –î–∏–Ω–∞–º—ñ—á–Ω–∞ —Ç–∞–±–ª–∏—Ü—è –ø–æ–∑–∏—Ü—ñ–π
- –ö–Ω–æ–ø–∫–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è/–≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ–π
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–æ—Ä–º–∏

#### **3.2 JavaScript —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª**
**–§–∞–π–ª:** `frontend/js/writeoff-document.js` (–Ω–æ–≤–∏–π)
- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—è–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç—É
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è —Å–µ–ª–µ–∫—Ç—ñ–≤
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
- –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

#### **3.3 –Ü—Å—Ç–æ—Ä—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —Å–ø–∏—Å–∞–Ω–Ω—è**
**–§–∞–π–ª:** `frontend/inventory.html` (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è)
- –¢–∞–±–ª–∏—Ü—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –∑ –ø–æ–∑–∏—Ü—ñ—è–º–∏
- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ –¥–∞—Ç–∞—Ö —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ–º—É
- –ü–µ—Ä–µ–≥–ª—è–¥ –¥–µ—Ç–∞–ª–µ–π –¥–æ–∫—É–º–µ–Ω—Ç—É
- –ï–∫—Å–ø–æ—Ä—Ç –≤ CSV

### **–§–ê–ó–ê 4: –Ü–ù–¢–ï–ì–†–ê–¶–Ü–Ø –¢–ê –¢–ï–°–¢–£–í–ê–ù–ù–Ø (2-3 –≥–æ–¥–∏–Ω–∏)**

#### **4.1 –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤**
- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö routes –¥–æ app-new.js
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —Å–∏—Å—Ç–µ–º–æ—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–∏—Å—Ç–µ–º–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è
- –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —Ä–∞–∑–æ–º

#### **4.2 –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É**
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –∑ –º–Ω–æ–∂–∏–Ω–Ω–∏–º–∏ –ø–æ–∑–∏—Ü—ñ—è–º–∏
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–∏—à–∫—ñ–≤
- –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö
- –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö

---

## üîß **–¢–ï–•–ù–Ü–ß–ù–Ü –†–Ü–®–ï–ù–ù–Ø**

### **–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –Ω–æ–º–µ—Ä—ñ–≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤:**
```javascript
// –§–æ—Ä–º–∞—Ç: WO-YYYYMMDD-NNN (WO = WriteOff)
const generateDocumentNumber = async (date) => {
    const dateStr = date.replace(/-/g, '');
    const existingCount = await getDocumentCountForDate(date);
    return `WO-${dateStr}-${String(existingCount + 1).padStart(3, '0')}`;
};
// –ü—Ä–∏–∫–ª–∞–¥: WO-20250713-001, WO-20250713-002
```

### **–ê–≤—Ç–æ–≤–∏–±—ñ—Ä –ø–∞—Ä—Ç—ñ–π (FIFO):**
```javascript
const selectBatchForWriteoff = async (productId, quantity) => {
    const batches = await getBatchesByProduct(productId);
    const availableBatches = batches
        .filter(b => b.available_quantity > 0)
        .sort((a, b) => new Date(a.batch_date) - new Date(b.batch_date));
    
    // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –Ω–∞–π—Å—Ç–∞—Ä—ñ—à—É –ø–∞—Ä—Ç—ñ—é
    return availableBatches[0];
};
```

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ API –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "document_number": "WO-20250713-001",
    "writeoff_date": "2025-07-13",
    "reason": "–ó–∞–∫—ñ–Ω—á–µ–Ω–Ω—è —Ç–µ—Ä–º—ñ–Ω—É –ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ",
    "responsible": "–Ü–≤–∞–Ω–æ–≤ –Ü.–Ü.",
    "writeoff_items": [
      {
        "id": 1,
        "product_id": 31,
        "quantity": 5,
        "batch_date": "2025-07-01",
        "notes": "–ü–∞—Ä—Ç—ñ—è –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∞",
        "products": {
          "name": "–ü—ñ—Ü–∞ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞",
          "code": "–ü–ú30"
        }
      }
    ]
  }
}
```

---

## ‚è±Ô∏è **–ß–ê–°–û–í–Ü –†–ê–ú–ö–ò**

### **–ó–∞–≥–∞–ª—å–Ω–∞ –æ—Ü—ñ–Ω–∫–∞: 12-16 –≥–æ–¥–∏–Ω**

| –§–∞–∑–∞ | –ó–∞–≤–¥–∞–Ω–Ω—è | –ß–∞—Å |
|------|----------|-----|
| 1 | –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è –ë–î | 3-4 –≥–æ–¥ |
| 2 | Backend —Ä–æ–∑—Ä–æ–±–∫–∞ | 4-5 –≥–æ–¥ |
| 3 | Frontend —Ä–æ–∑—Ä–æ–±–∫–∞ | 3-4 –≥–æ–¥ |
| 4 | –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è | 2-3 –≥–æ–¥ |

### **–ü–æ–µ—Ç–∞–ø–Ω–µ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è:**
- **–¢–∏–∂–¥–µ–Ω—å 1:** –§–∞–∑–∏ 1-2 (Backend –≥–æ—Ç–æ–≤–∏–π)
- **–¢–∏–∂–¥–µ–Ω—å 2:** –§–∞–∑–∏ 3-4 (–ü–æ–≤–Ω–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª)

---

## üéØ **–ö–†–ò–¢–ï–†–Ü–á –£–°–ü–Ü–®–ù–û–°–¢–Ü**

### **–ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –≤–∏–º–æ–≥–∏:**
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –∑ –º–Ω–æ–∂–∏–Ω–Ω–∏–º–∏ –ø–æ–∑–∏—Ü—ñ—è–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–∏—à–∫—ñ–≤ —Ç–æ–≤–∞—Ä—ñ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä—Ç—ñ–π
- ‚úÖ –Ü—Å—Ç–æ—Ä—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —Å–ø–∏—Å–∞–Ω–Ω—è –∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—î—é
- ‚úÖ –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑—ñ —Å—Ç–∞—Ä–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏

### **–î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**
- ‚úÖ –ê–≤—Ç–æ–≤–∏–±—ñ—Ä –Ω–∞–π—Å—Ç–∞—Ä—ñ—à–æ—ó –ø–∞—Ä—Ç—ñ—ó (FIFO)
- ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ç–æ–≤–∞—Ä—ñ–≤ –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–Ω—è–º
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏
- ‚úÖ –ï–∫—Å–ø–æ—Ä—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –≤ CSV
- ‚úÖ –ú–æ–±—ñ–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è —Ñ–æ—Ä–º–∏

---

## üîÑ **–ü–ï–†–ï–í–ê–ì–ò –ù–û–í–û–á –ê–†–•–Ü–¢–ï–ö–¢–£–†–ò**

### **–î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:**
- üöÄ **–®–≤–∏–¥–∫—ñ—Å—Ç—å:** –û–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç –∑–∞–º—ñ—Å—Ç—å –¥–µ–∫—ñ–ª—å–∫–æ—Ö –∑–∞–ø–∏—Å—ñ–≤
- üéØ **–ó—Ä—É—á–Ω—ñ—Å—Ç—å:** –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –ª–æ–≥—ñ—á–Ω–æ –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–ø–∏—Å–∞–Ω—å
- üìä **–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞:** –ö—Ä–∞—â–∞ –∑–≤—ñ—Ç–Ω—ñ—Å—Ç—å –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
- üîç **–ü–æ—à—É–∫:** –õ–µ–≥—à–µ –∑–Ω–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ —Å–ø–∏—Å–∞–Ω–Ω—è

### **–î–ª—è —Å–∏—Å—Ç–µ–º–∏:**
- üìà **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å:** –õ–µ–≥—à–µ –æ–±—Ä–æ–±–ª—è—Ç–∏ –≤–µ–ª–∏–∫—ñ —Å–ø–∏—Å–∞–Ω–Ω—è
- üîí **–¶—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å:** –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–∞ –±–µ–∑–ø–µ–∫–∞
- üõ†Ô∏è **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞:** –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –∑ –ø—Ä–∏—Ö–æ–¥–∞–º–∏
- üì± **–†–æ–∑—à–∏—Ä—é–≤–∞–Ω—ñ—Å—Ç—å:** –õ–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

---

## üìã **CHECKLIST –†–ï–ê–õ–Ü–ó–ê–¶–Ü–á**

### **Backend (7-9 –≥–æ–¥–∏–Ω):**
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è –ë–î
- [ ] –î–æ–¥–∞—Ç–∏ writeoffDocumentQueries –≤ supabase-database.js
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ WriteoffDocumentService
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ WriteoffDocumentController
- [ ] –î–æ–¥–∞—Ç–∏ routes –¥–ª—è –Ω–æ–≤–∏—Ö endpoints
- [ ] –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –≤ app-new.js
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –≤—Å—ñ API endpoints

### **Frontend (3-4 –≥–æ–¥–∏–Ω–∏):**
- [ ] –û–Ω–æ–≤–∏—Ç–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ inventory.html
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ writeoff-document.js
- [ ] –î–æ–¥–∞—Ç–∏ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è —Ñ–æ—Ä–º–∏
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- [ ] –î–æ–¥–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö

### **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è (2-3 –≥–æ–¥–∏–Ω–∏):**
- [ ] –í–∏–∫–æ–Ω–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é —ñ—Å–Ω—É—é—á–∏—Ö –¥–∞–Ω–∏—Ö
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω—É —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- [ ] –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é

---

## üéØ **–ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò**

1. **–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–ª–∞–Ω—É:** –£–∑–≥–æ–¥–∏—Ç–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è
2. **–ü–æ—á–∞—Ç–æ–∫ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó:** –†–æ–∑–ø–æ—á–∞—Ç–∏ –∑ –§–∞–∑–∏ 1 (–ë–î)
3. **–ü–æ–µ—Ç–∞–ø–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:** –¢–µ—Å—Ç—É–≤–∞—Ç–∏ –∫–æ–∂–Ω—É —Ñ–∞–∑—É –æ–∫—Ä–µ–º–æ
4. **–§—ñ–Ω–∞–ª—å–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è:** –û–±'—î–¥–Ω–∞—Ç–∏ –≤—Å—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
5. **–ó–∞–ø—É—Å–∫ –≤ production:** –ü–æ—Å—Ç—É–ø–æ–≤–∏–π –ø–µ—Ä–µ—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

---


## ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–ê –ó–ê–î–ê–ß–ê: –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø UNDEFINED –¢–û–í–ê–†–Ü–í –í –Ü–°–¢–û–†–Ü–á –°–ü–ò–°–ê–ù–ù–Ø**

### **Complexity Level: 1 (Quick Bug Fix) - –ó–ê–í–ï–†–®–ï–ù–û**

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùå –ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ inventory.html —É –≤–∫–ª–∞–¥—Ü—ñ "–°–ø–∏—Å–∞–Ω–Ω—è" –≤ —ñ—Å—Ç–æ—Ä—ñ—ó —Å–ø–∏—Å–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–ª–∏—Å—è —è–∫ "undefined (undefined)"

**–ü—Ä–∏—á–∏–Ω–∞:** üîç API endpoint `/api/writeoffs` –ø–æ–≤–µ—Ä—Ç–∞–≤ –¥–∞–Ω—ñ —É —Ñ–æ—Ä–º–∞—Ç—ñ `products: {name, code}`, –∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—á—ñ–∫—É–≤–∞–≤ `product_name` —Ç–∞ `product_code`

### **üìã –í–ò–ö–û–ù–ê–ù–Ü –ó–ú–Ü–ù–ò:**

#### ‚úÖ **Backend –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**

1. **–§–∞–π–ª:** `backend/supabase-database.js`
   - **–ú–µ—Ç–æ–¥:** `writeoffQueries.getAll()`
   - **–ó–º—ñ–Ω–∞:** –î–æ–¥–∞–Ω–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—é –¥–∞–Ω–∏—Ö –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
   ```javascript
   // –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
   const transformedData = data.map(item => ({
       ...item,
       product_name: item.products?.name,
       product_code: item.products?.code
   }));
   ```

2. **–§–∞–π–ª:** `backend/supabase-database.js`
   - **–ú–µ—Ç–æ–¥:** `writeoffQueries.getByProduct()`
   - **–ó–º—ñ–Ω–∞:** –î–æ–¥–∞–Ω–æ JOIN –∑ —Ç–∞–±–ª–∏—Ü–µ—é products —Ç–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—é –¥–∞–Ω–∏—Ö
   ```javascript
   .select(`
       *,
       products (name, code)
   `)
   // + –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
   ```

#### ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ API —Ç–µ–ø–µ—Ä –ø–æ–≤–µ—Ä—Ç–∞—î —ñ –≤–∫–ª–∞–¥–µ–Ω–∏–π –æ–±'—î–∫—Ç `products`, —ñ –æ–∫—Ä–µ–º—ñ –ø–æ–ª—è `product_name`, `product_code`
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –Ω–∞–∑–≤–∏ —Ç–∞ –∫–æ–¥–∏ —Ç–æ–≤–∞—Ä—ñ–≤ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó —Å–ø–∏—Å–∞–Ω–Ω—è
- ‚úÖ –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –¥–ª—è —ñ–Ω—à–∏—Ö —á–∞—Å—Ç–∏–Ω —Å–∏—Å—Ç–µ–º–∏

### **üß™ –¢–ï–°–¢–£–í–ê–ù–ù–Ø:**
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ API endpoint: `GET /api/writeoffs` –ø–æ–≤–µ—Ä—Ç–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ –±—Ä–∞—É–∑–µ—Ä—ñ: —Ç–æ–≤–∞—Ä–∏ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ —Ç–∞ –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ

---

## ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–ê –ó–ê–î–ê–ß–ê: –ü–û–í–ù–ò–ô –ü–ï–†–ï–•–Ü–î –ù–ê SUPABASE**

### **Complexity Level: 3 (Intermediate Feature) - –ó–ê–í–ï–†–®–ï–ù–û**

**–ú–µ—Ç–∞:** ‚úÖ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å–∏—Å—Ç–µ–º–∏ –∑ –≥—ñ–±—Ä–∏–¥–Ω–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É (Supabase + SQLite) –Ω–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é Supabase PostgreSQL

### **üìä –†–ï–ó–£–õ–¨–¢–ê–¢–ò –ú–Ü–ì–†–ê–¶–Ü–á:**

#### ‚úÖ **–ú–Ü–ì–†–û–í–ê–ù–Ü –ö–û–ú–ü–û–ù–ï–ù–¢–ò:**
- **Express Sessions** - ‚úÖ SQLite ‚Üí Supabase user_sessions
- **production_batches** - ‚úÖ SQLite ‚Üí Supabase
- **–í—Å—ñ queries** - ‚úÖ 100% Supabase

#### ‚úÖ **–í–ò–î–ê–õ–ï–ù–Ü –ó–ê–õ–ï–ñ–ù–û–°–¢–Ü:**
- **sqlite3** - –≤–∏–¥–∞–ª–µ–Ω–æ –∑ package.json
- **connect-sqlite3** - –≤–∏–¥–∞–ª–µ–Ω–æ –∑ package.json
- **database-hybrid.js** - —Å—Ç–≤–æ—Ä–µ–Ω–æ backup

#### ‚úÖ **–°–¢–ê–¢–ò–°–¢–ò–ö–ê:**
- **12 —Ç–æ–≤–∞—Ä—ñ–≤** –≤ Supabase
- **2 –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è** –≤ Supabase  
- **4 –ø–∞—Ä—Ç—ñ—ó** –≤ Supabase
- **100% Supabase** - –∂–æ–¥–Ω–∏—Ö SQLite –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π


---

## üé® **CREATIVE PHASES COMPLETED**

### **‚úÖ –ó–ê–í–ï–†–®–ï–ù–û: –¢–í–û–†–ß–Ü –§–ê–ó–ò –î–ò–ó–ê–ô–ù–£**

**–î–∞—Ç–∞:** 2025-07-13 18:51:33  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–Ü–• –¢–í–û–†–ß–ò–• –§–ê–ó –ó–ê–í–ï–†–®–ï–ù–û  
**–§–∞–π–ª:** `memory-bank/creative/creative-writeoff-documents.md`

### **üìã –ü–†–ò–ô–ù–Ø–¢–Ü –†–Ü–®–ï–ù–ù–Ø:**

#### **üèóÔ∏è –ê–†–•–Ü–¢–ï–ö–¢–£–†–ê: –ì—ñ–±—Ä–∏–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞**
- **–†—ñ—à–µ–Ω–Ω—è:** –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ `writeoff_documents` + `writeoff_items`
- **–°—Ç—Ä–∞—Ç–µ–≥—ñ—è:** –ó–±–µ—Ä–µ–≥—Ç–∏ —Å—Ç–∞—Ä—É —Ç–∞–±–ª–∏—Ü—é `writeoffs` –¥–ª—è —ñ—Å—Ç–æ—Ä—ñ—ó
- **API:** Unified –ø—ñ–¥—Ö—ñ–¥ (–Ω–æ–≤—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ ‚Üí –Ω–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —ñ—Å—Ç–æ—Ä—ñ—è ‚Üí –∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∞)
- **–ü–µ—Ä–µ–≤–∞–≥–∏:** –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å, –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Ä–∏–∑–∏–∫, –ø–æ—Å—Ç—É–ø–æ–≤–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è

#### **üé® UI/UX: –§–æ—Ä–º–∞ –∑ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–º–∏ —Å–µ–∫—Ü—ñ—è–º–∏**
- **–†—ñ—à–µ–Ω–Ω—è:** –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç—É + –¥–∏–Ω–∞–º—ñ—á–Ω—ñ —Å–µ–∫—Ü—ñ—ó –¥–ª—è –ø–æ–∑–∏—Ü—ñ–π
- **–í–∞–ª—ñ–¥–∞—Ü—ñ—è:** –†–µ–∞–ª—å–Ω–∏–π —á–∞—Å –¥–ª—è –∫–æ–∂–Ω–æ—ó –ø–æ–∑–∏—Ü—ñ—ó
- **–ú–æ–±—ñ–ª—å–Ω—ñ—Å—Ç—å:** –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –¥–∏–∑–∞–π–Ω –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
- **–ü–µ—Ä–µ–≤–∞–≥–∏:** –ß—ñ—Ç–∫–∏–π –ø–æ–¥—ñ–ª —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, –ª–µ–≥–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è, –∑—Ä—É—á–Ω—ñ—Å—Ç—å

#### **üóÉÔ∏è DATA MODEL: –†–æ–∑—à–∏—Ä–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
- **–†—ñ—à–µ–Ω–Ω—è:** –ü–æ–≤–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑ –∞—É–¥–∏—Ç–æ–º —Ç–∞ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏
- **–ü–æ–ª—è:** document_number, batch_date, notes, created_by, timestamps
- **–Ü–Ω–¥–µ–∫—Å–∏:** –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –¥–ª—è –ø–æ—à—É–∫—É —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏
- **–ü–µ—Ä–µ–≤–∞–≥–∏:** –ü–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è, –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∞—É–¥–∏—Ç—É, –≥–Ω—É—á–∫—ñ—Å—Ç—å

### **üìä IMPLEMENTATION ROADMAP:**

#### **–§–∞–∑–∞ 1: Backend (6-8 –≥–æ–¥–∏–Ω)**
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è –Ω–æ–≤–∏—Ö —Ç–∞–±–ª–∏—Ü—å
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≥—ñ–±—Ä–∏–¥–Ω—É –ª–æ–≥—ñ–∫—É –≤ API
- [ ] –î–æ–¥–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é —Ç–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—é –Ω–æ–º–µ—Ä—ñ–≤ (WO-YYYYMMDD-NNN)

#### **–§–∞–∑–∞ 2: Frontend (3-4 –≥–æ–¥–∏–Ω–∏)**
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–æ—Ä–º—É –∑ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–º–∏ —Å–µ–∫—Ü—ñ—è–º–∏
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- [ ] –î–æ–¥–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- [ ] –ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –º–æ–±—ñ–ª—å–Ω—É –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å

#### **–§–∞–∑–∞ 3: Integration (2-3 –≥–æ–¥–∏–Ω–∏)**
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –≥—ñ–±—Ä–∏–¥–Ω—É —Å–∏—Å—Ç–µ–º—É
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω—É —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é —ñ—Å–Ω—É—é—á–∏—Ö –¥–∞–Ω–∏—Ö
- [ ] –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

### **üéØ –ì–û–¢–û–í–ù–Ü–°–¢–¨ –î–û –†–ï–ê–õ–Ü–ó–ê–¶–Ü–á:**

‚úÖ **–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç—ñ**  
‚úÖ **UI/UX –¥–∏–∑–∞–π–Ω –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π**  
‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö —Å–ø—Ä–æ–µ–∫—Ç–æ–≤–∞–Ω–∞**  
‚úÖ **Implementation guidelines —Å—Ç–≤–æ—Ä–µ–Ω—ñ**  

---

## ‚è≠Ô∏è **–ù–ê–°–¢–£–ü–ù–ò–ô –ö–†–û–ö: IMPLEMENT MODE**

**–°—Ç–∞—Ç—É—Å:** üöÄ –ì–û–¢–û–í–û –î–û –†–ï–ê–õ–Ü–ó–ê–¶–Ü–á  
**–ó–∞–≥–∞–ª—å–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ —á–∞—Å—É:** 11-15 –≥–æ–¥–∏–Ω  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –ü–µ—Ä–µ–π—Ç–∏ –≤ IMPLEMENT MODE –¥–ª—è –ø–æ—á–∞—Ç–∫—É —Ä–æ–∑—Ä–æ–±–∫–∏

